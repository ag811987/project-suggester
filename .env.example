# Research Pivot Advisor System - Environment Variables

# ============================================
# REQUIRED CONFIGURATION
# ============================================

# OpenAI API (Required for LLM operations)
# Get from: https://platform.openai.com/api-keys
OPENAI_API_KEY=sk-...

# Database Configuration (PostgreSQL)
# Local Docker: postgresql+asyncpg://postgres:postgres@localhost:5432/research_advisor
# Supabase direct (may have IPv4 issues): postgresql+asyncpg://postgres:[PASSWORD]@db.[PROJECT-REF].supabase.co:5432/postgres
# Supabase Session Pooler (recommended): postgresql+asyncpg://postgres.[PROJECT-REF]:[PASSWORD]@aws-1-us-east-1.pooler.supabase.com:5432/postgres
# Supabase Transaction Pooler: postgresql+asyncpg://postgres.[PROJECT-REF]:[PASSWORD]@aws-1-us-east-1.pooler.supabase.com:6543/postgres
DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5432/research_advisor

# Redis Configuration (Session storage)
# Default for local Docker setup
REDIS_URL=redis://localhost:6379/0

# ============================================
# OPTIONAL CONFIGURATION
# ============================================

# OpenAlex API (Optional - improves rate limits)
# For higher tier accounts, use API key. Otherwise just provide email.
# Provides access to "polite pool" with better rate limits
OPENALEX_API_KEY=your_openalex_api_key
OPENALEX_EMAIL=your.email@example.com

# Use semantic search (hybrid with keyword when budget allows; requires OPENALEX_API_KEY)
# Semantic search costs $0.01/query. When budget low, falls back to keyword-only.
# Default: false
OPENALEX_USE_SEMANTIC_SEARCH=false

# Skip semantic search when remaining daily budget (USD) is below this
# Default: 0.05 (~5 semantic queries remaining)
# OPENALEX_SEMANTIC_BUDGET_THRESHOLD=0.05

# Multi-query: run 3-5 keyword variants in parallel for better coverage (default: true)
# OPENALEX_MULTI_QUERY=true
# Papers per query variant (default: 5)
# OPENALEX_QUERIES_PER_VARIANT=5
# Rerank merged papers by embedding similarity (default: false)
# OPENALEX_USE_EMBEDDING_RERANK=false

# Oxylabs Proxy (For web scraping gap maps)
# Get from: https://oxylabs.io/
# Uses "universal" source for general web scraping
# API endpoint: https://realtime.oxylabs.io/v1/queries
# Note: Can skip for MVP and use hardcoded sample data
OXYLABS_USERNAME=your_oxylabs_username
OXYLABS_PASSWORD=your_oxylabs_password

# ============================================
# APPLICATION SETTINGS
# ============================================

# Session TTL (Time-to-live in seconds)
# How long user research data is kept in Redis
# Default: 3600 (1 hour)
# Privacy: Shorter is better. Max recommended: 7200 (2 hours)
SESSION_TTL_SECONDS=3600

# API Configuration
API_HOST=0.0.0.0
API_PORT=8000
API_RELOAD=true

# CORS Configuration
# Allowed origins for CORS (comma-separated)
# For local development: http://localhost:5173 (Vite dev server)
# For production: https://your-domain.com
CORS_ORIGINS=http://localhost:5173,http://localhost:3000

# ============================================
# LOGGING & MONITORING
# ============================================

# Log Level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
LOG_LEVEL=INFO

# Sentry DSN (Optional - for error tracking in production)
# SENTRY_DSN=https://...@sentry.io/...

# ============================================
# BACKGROUND JOBS
# ============================================

# Gap Map Scraper Schedule (Cron expression)
# Default: Daily at 2:00 AM
# Format: "minute hour day month day_of_week"
SCRAPER_SCHEDULE_CRON=0 2 * * *

# Scraper Job Timeout (seconds)
# Maximum time allowed for scraping all sources
SCRAPER_TIMEOUT=600

# ============================================
# FEATURE FLAGS (Optional)
# ============================================

# Enable/disable background scraper job
# Set to "false" to disable background scraping (use static data only)
ENABLE_BACKGROUND_SCRAPER=true

# Enable/disable file upload
# Set to "false" to disable file uploads (chat only)
ENABLE_FILE_UPLOAD=true

# Maximum file upload size (MB)
MAX_UPLOAD_SIZE_MB=10

# FWCI Calibration (OpenAlex FWCI tends to inflate vs SciVal; see docs/FWCI_CALIBRATION.md)
# Stricter thresholds reduce false HIGH scores. Research suggests OpenAlex ~1.5x higher than SciVal.
# FWCI_HIGH_THRESHOLD=2.2
# FWCI_LOW_THRESHOLD=1.2
# OPENALEX_SEARCH_LIMIT=8  # Papers to fetch (3-10 recommended for tight, closely related results)

# ============================================
# DEVELOPMENT SETTINGS
# ============================================

# Environment (development, staging, production)
ENVIRONMENT=development

# Debug mode (true/false)
# NEVER set to true in production
DEBUG=true

# ============================================
# TESTING OVERRIDES
# ============================================

# Test Database URL (used in pytest)
# TEST_DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5432/research_advisor_test

# Mock External APIs (for testing)
# Set to "true" to use mock responses instead of real API calls
# MOCK_OPENAI=false
# MOCK_OPENALEX=false
# MOCK_OXYLABS=false
